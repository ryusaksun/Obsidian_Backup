分水岭算法（Watershed Algorithm）是一种基于地理地貌概念的图像分割算法。它的核心思想是把图像看作一张三维地形图，然后通过模拟"涨水"的过程来把不同的区域分离开。

## 1. 核心比喻：地形与洪水

想象一张灰度图：

- 像素灰度值 = 海拔高度：灰度值低的地方（暗处）是盆地/山谷，灰度值高的地方（亮处）是山峰/山脊。

- 边缘 = 山岭：图像中物体的边缘通常灰度变化剧烈，对应地形图上的陡峭山岭。

算法过程就像是发洪水：

1. 注水：我们在所有的局部最低点（盆地中心）打个洞，让水慢慢涌出来。

2. 上涨：随着水位不断升高，不同的盆地里的水面积会越来越大。

3. 筑坝：当两个不同盆地的水即将汇合时，为了不让它们混在一起，我们就在交界处修建大坝。

4. 分割：水位一直涨到最高峰，最后剩下的这些"大坝"连成的线，就是分水岭（Watershed Line），也就是我们分割出来的物体边缘。

## 2. 关键问题：过度分割（Over-segmentation）

原始的分水岭算法有一个致命弱点：太敏感了。

- 原因：图像上任何一点小小的噪点（比如一个微小的灰度波动），都会被当成一个新的独立盆地。

- 后果：最后分出来的结果就像破碎的玻璃一样，密密麻麻全是小块，根本没法用。

## 3. 解决方案：标记控制分水岭（Marker-controlled Watershed）

为了解决乱分的问题，现在的分水岭算法通常是有人工干预的。

### 设标记（Markers）

我们不再让水从随便哪个坑里冒出来，而是指定几个注水点。

- 前景标记：点在物体内部（告诉算法：这块肯定是物体）。

- 背景标记：点在背景区域（告诉算法：这块肯定是背景）。

### 只准这里冒水

算法只允许水从我们标记的这些地方开始涨。这样，那些乱七八糟的小噪点盆地就没机会捣乱了。

## 4. 优缺点

- 优点：

    - 封闭性好：分出来的边缘肯定是个圈，不会断开（不像 Canny 有时会断）。

    - 适合粘连物体：对于挨得很近的物体（比如一盘豆子），分水岭算法特别擅长把它们切开。

- 缺点：

    - 必须预处理：通常需要配合距离变换、滤波或者人工标记才能用，直接用效果很差。

## 一句话总结

分水岭算法就是把图像看成山谷，往里灌水，水碰头的地方修大坝，最后大坝就是物体的边界。

---

**<font color="#2ecc71">✅ 已格式化</font>**
