Canny 算子中的非极大值抑制（Non-Maximum Suppression, NMS）是其最核心的步骤之一。如果说梯度计算是"画出粗线条的轮廓"，那么非极大值抑制就是把粗线条削成单像素宽的细线，从而实现边缘的精准定位。

## 1. 核心目的：边缘细化

在经过 Sobel 算子计算梯度后，我们得到的边缘通常是宽宽的、模糊的（因为图像亮度变化是一个渐变过程，导致边缘附近的多个像素都有较大的梯度值）。

NMS 的任务是：在这些一堆梯度值较大的像素中，只保留"峰顶"（局部最大值），把"山坡"（非最大值）全部砍掉（置为 0），从而得到最细、最准的边缘线。

## 2. 核心原理：顺着梯度的方向找山峰

判断一个点是不是"局部最大值"，关键在于和谁比。

在 NMS 中，我们不是和上下左右随便比，而是沿着梯度方向进行比较。

- 梯度方向的物理意义：梯度方向总是指向亮度变化最剧烈的方向（垂直于边缘的方向）。例如，如果边缘是竖直的，梯度方向就是水平的。
- 比较逻辑：

    对于任意一个像素点 $P(x,y)$，如果它是边缘点，那么它的梯度幅值 $M(P)$ 应该比它梯度方向上的前一个点和后一个点都要大。

    - 如果 $M(P) > M(\text{前一个})$ 且 $M(P) > M(\text{后一个})$：保留 $P$（它是峰顶）。
    - 否则：抑制 $P$（令其梯度值为 0）。

## 3. 具体实现时的"方向量化"

在数字图像中，像素是离散的网格，梯度方向（如 $37.5^\circ$）上通常没有整像素点。为了简化计算，Canny 算法通常把梯度方向量化为 4 个主方向：

| 真实梯度角度 $\theta$ | 量化方向 | 比较邻居 |
| --- | --- | --- |
| $-22.5^\circ \sim 22.5^\circ$ | 水平方向 (0) | 左右邻居：$(x-1, y)$ 和 $(x+1, y)$ |
| $22.5^\circ \sim 67.5^\circ$ | 右对角方向 (1) | 右上/左下：$(x+1, y-1)$ 和 $(x-1, y+1)$ |
| $67.5^\circ \sim 112.5^\circ$ | 垂直方向 (2) | 上下邻居：$(x, y-1)$ 和 $(x, y+1)$ |
| $112.5^\circ \sim 157.5^\circ$ | 左对角方向 (3) | 左上/右下：$(x-1, y-1)$ 和 $(x+1, y+1)$ |

（注：也有更加精确的方法，不量化方向，而是利用线性插值算出亚像素位置的梯度值来进行比较，精度更高但计算更慢。）

## 4. 举个直观例子

假设你检测到一条竖直的边缘（也就是梯度方向是水平的）。

现在的边缘可能有 3 个像素宽，梯度值分别是：

`左: 100`, `中: 200`, `右: 150`

- NMS 会考察中间点（200）：

    - 它的梯度方向是水平的。
    - 看左边（100）：200 > 100，胜出。
    - 看右边（150）：200 > 150，胜出。
    - 结果：中间点保留。

- NMS 会考察右边点（150）：

    - 它的梯度方向也是水平的。
    - 看左边（200）：150 < 200，失败。
    - 结果：右边点被置为 0。

经过这一步，原本宽宽的边缘就只剩下了中间那个最强的点，实现了边缘细化。

---

**<font color="#2ecc71">✅ 已格式化</font>**
