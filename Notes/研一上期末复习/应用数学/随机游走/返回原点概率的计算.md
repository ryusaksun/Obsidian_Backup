根据您提供的北京大学随机过程课件资料，关于随机游走（Random Walk）模型中经过 $n$ 步返回原点和第一次返回原点的概率计算公式总结如下：

## 1. 模型设定

设质点在 $x$ 轴上作随机游动，初始位置为原点（$t=0, X_0=0$）。

- 向正方向（+1）移动的概率为 $p$。
- 向反方向（-1）移动的概率为 $q = 1-p$。
- 记 $u_n$ 为第 $n$ 步处于原点的概率。
- 记 $v_n$ 为第 $n$ 步第一次返回原点的概率。

## 2. 经过 $n$ 步返回原点的概率（$u_n$）

质点要返回原点，必须向左和向右移动的步数相等。因此，总步数 $n$ 必须为偶数。如果 $n$ 为奇数，返回原点的概率为 0。

设 $n = 2m$（$m$ 为正整数），则经过 $2m$ 步返回原点的概率公式为：

$$u_{2m} = P(S_{2m}=0) = C_{2m}^m p^m q^m$$

### 公式解释

- $C_{2m}^m$：在 $2m$ 步中，选出 $m$ 步向右（剩下 $m$ 步自然向左）的组合数。
- $p^m q^m$：向右走 $m$ 步和向左走 $m$ 步的概率乘积。

## 3. 经过 $n$ 步第一次返回原点的概率（$v_n$）

记 $v_n$ 为第 $n$ 步首次返回原点的概率（同样要求 $n$ 为偶数，即 $n=2m$）。直接计算组合数较为复杂，通常利用与 $u_n$ 的递推关系（卷积公式）或母函数（Generating Function）来求解。

### （1）卷积公式（递推关系）

第 $2n$ 步处于原点的事件，可以分解为在第 $2k$ 步第一次返回原点，且在剩下的 $2n-2k$ 步中（可能多次）又回到原点的互斥事件之和。公式如下：

$$u_{2n} = \sum_{k=1}^{n} v_{2k} u_{2n-2k}$$

（其中 $u_0 = 1$）

### （2）母函数计算公式（核心方法）

利用母函数（Generating Function）可以推导出 $v_n$ 的解析形式。

设 $u_n$ 的生成函数为 $U(z)$，$v_n$ 的生成函数为 $V(z)$，它们满足关系：

$$V(z) = 1 - \frac{1}{U(z)}$$

根据 $u_{2m}$ 的通项公式，可以求得 $U(z)$，进而得到 $V(z)$ 的显式公式：

$$V(z) = 1 - \sqrt{1 - 4pqz^2}$$

### 计算 $v_n$ 的步骤

通过对上述 $V(z)$ 进行泰勒展开（Taylor Expansion），可以得到 $z^{2n}$ 的系数，即为 $v_{2n}$ 的通项公式。

## 总结对比

| 概率类型 | 符号 | 计算公式 / 关键关系 | 备注 |
| :---------- | :------- | :------------------------------------------------------- | :-------------- |
| 处于原点 | $u_{2m}$ | $\displaystyle C_{2m}^m p^m q^m$ | $n$ 必须为偶数，否则为 0 |
| 首次返回 | $v_{2n}$ | $\displaystyle u_{2n} = \sum_{k=1}^{n} v_{2k} u_{2n-2k}$ | 卷积公式，常用于递推求解 |
| （母函数形式） | $V(z)$ | $\displaystyle 1 - \sqrt{1 - 4pqz^2}$ | 用于推导通项或计算总返回概率 |

## V2n 的通项公式

根据北大随机过程课件资料，得到 $v_{2n}$（第 $2n$ 步第一次返回原点的概率）通项公式的推导步骤如下：

### 1. 确定第 $2n$ 步处于原点的概率 $u_{2n}$

首先，质点要返回原点必须经过偶数步。第 $2n$ 步处于原点的概率 $u_{2n}$ 是二项分布的特定项（向右 $n$ 步，向左 $n$ 步）：

$$u_{2n} = C_{2n}^n p^n q^n$$

其中 $p$ 为向右概率，$q=1-p$ 为向左概率。

### 2. 建立 $u_{2n}$ 与 $v_{2n}$ 的卷积关系

利用全概率公式分析：第 $2n$ 步处于原点的事件，可以分解为在第 $2k$ 步（$k=1 \dots n$）第一次返回原点，然后在剩下的 $2n-2k$ 步中（可能多次）又回到原点的互斥事件之和。即满足卷积公式：

$$u_{2n} = \sum_{k=1}^{n} v_{2k} u_{2n-2k}$$

其中规定 $u_0 = 1$。

### 3. 利用母函数（Generating Function）求解

这是解题的核心技巧。定义 $u_{2n}$ 和 $v_{2n}$ 的生成函数分别为 $U(z)$ 和 $V(z)$：

$$U(z) = \sum_{n=0}^{\infty} u_{2n} z^{2n}, \quad V(z) = \sum_{n=1}^{\infty} v_{2n} z^{2n}$$

根据上述卷积关系，可以推导出两者满足代数方程：

$$U(z) = 1 + U(z)V(z) \implies V(z) = 1 - \frac{1}{U(z)}$$

### 4. 计算 $U(z)$ 的显式表达式

根据 $u_{2n}$ 的通项公式，利用广义二项式定理（泰勒展开）的逆运算，可以求得 $U(z)$：

$$U(z) = \sum_{n=0}^{\infty} C_{2n}^n (pq)^n z^{2n} = (1 - 4pqz^2)^{-1/2}$$

### 5. 推导 $V(z)$ 并展开求通项

将 $U(z)$ 代入 $V(z)$ 的关系式中：

$$V(z) = 1 - \sqrt{1 - 4pqz^2}$$

为了得到 $v_{2n}$，需要将 $\sqrt{1 - 4pqz^2}$ 进行泰勒级数展开。利用幂函数 $(1-x)^{1/2}$ 的展开公式：

$$(1-x)^{1/2} = 1 - \sum_{n=1}^{\infty} \frac{1}{2n-1} C_{2n}^n (\frac{x}{4})^n$$

令 $x = 4pqz^2$，代入上式可得：

$$V(z) = 1 - \left[ 1 - \sum_{n=1}^{\infty} \frac{1}{2n-1} C_{2n}^n (\frac{x}{4})^n \right] = \sum_{n=1}^{\infty} \left[ \frac{1}{2n-1} C_{2n}^n p^n q^n \right] z^{2n}$$

### 6. 结论：$v_{2n}$ 的通项公式

对比 $V(z)$ 定义式中 $z^{2n}$ 的系数，即可得到 $v_{2n}$ 的通项公式：

$$v_{2n} = \frac{1}{2n-1} C_{2n}^n p^n q^n$$

或者写作与 $u_{2n}$ 的关系：

$$v_{2n} = \frac{1}{2n-1} u_{2n}$$

---

**<font color="#2ecc71">✅ 已格式化</font>**
