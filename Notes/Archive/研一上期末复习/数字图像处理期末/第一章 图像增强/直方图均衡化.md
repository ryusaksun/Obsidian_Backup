## 定义与目的

- 定义: 直方图均衡化是一种通过对图像的直方图进行修正来获得图像增强效果的自动方法。
- 主要用途: 主要用于增强动态范围偏小的图像的反差(对比度)。

## 基本思想(原理)

- 其核心思想是将原始图像的直方图变换为在整个灰度范围内均匀分布的形式。
- 通过这种变换,增加了像素灰度值的动态范围,从而达到增强图像整体对比度的效果。

## 具体算法步骤

### 求直方图

统计原图像 $f$ 中每个灰度级出现的像素个数,得到灰度直方图 $h$。

### 计算概率

计算每个灰度级的像素个数在整个图像像素总数($N_f = m \times n$)中所占的百分比 $hs(i)$。

公式: $hs(i) = h(i) / N_f$

- $h(i)$: 灰度级 $i$ 的像素个数。
- $N_f$: 图像的总像素个数(即 $长 \times 宽$)。

这一步得到了每个灰度级在图像中出现的概率。

### 计算累计分布

计算图像各灰度级的累计分布 $hp(i)$,即从灰度级 0 到 $i$ 的概率之和。

公式: $$hp(i) = \sum_{k=0}^{i} hs(k)$$

即: $hp(i) = hs(0) + hs(1) + ... + hs(i)$

物理意义: $hp(i)$ 代表了图像中灰度值 $\le i$ 的所有像素占总像素的比例。

- $hp(0) = hs(0)$
- $hp(1) = hs(0) + hs(1)$
- ...
- $hp(255) = 1.0$(因为所有概率之和必须为 1)。

### 映射新灰度值

根据累计分布求出新的灰度值。

公式: $g = 255 \cdot hp(i)$(对于 8 位图像,最大灰度级为 255)

- $i$: 原始图像中的某个灰度级
- $hp(i)$: 累计分布(即原始图像中灰度 $\le i$ 的像素所占的百分比)
- $255$: 图像的最大灰度级($L-1$)
- $g$: $i$ 对应的新灰度值(通常需要四舍五入取整)。

简单来说,直方图均衡化就是把原本集中在某个灰度区间的像素,拉伸并均匀地分布到整个可能的灰度范围内(如 0-255),让图像看起来更清晰、对比度更高。

## 累计分布详解

### 什么是累计分布

累计分布描述的是图像中灰度值小于或等于某个特定值 $i$ 的像素在图像中所占的比例总和。在直方图均衡化中,它是通过对归一化直方图(概率)进行累加求和得到的。

### 计算示例

假设数据:
- 灰度级 0 的概率 $hs(0) = 0.12$
- 灰度级 1 的概率 $hs(1) = 0.08$
- 灰度级 2 的概率 $hs(2) = 0.16$

累计分布计算过程:

- $i=0$ 时: $hp(0) = hs(0) = 0.12$
- $i=1$ 时: $hp(1) = hp(0) + hs(1) = 0.12 + 0.08 = 0.20$
- $i=2$ 时: $hp(2) = hp(1) + hs(2) = 0.20 + 0.16 = 0.36$
- 直到最后一个灰度级,累计值应为 1.00

### 作用

计算出累计分布 $hp(i)$ 后,它将直接作为映射因子参与最后一步的灰度映射。

新灰度值 $g = 255 \times hp(i)$

## 映射过程详解

### 核心映射机制

映射是针对当前这一个灰度级 $i$ 进行的,是一一对应(或多对一)的映射,而不是将某个范围内的所有值压缩成一个值。

### 映射示例

假设计算出的累计分布如下:

当原始灰度 $i = 0$ 时:
- 累计分布 $hp(0) = 0.12$(意味着有 12% 的像素比它暗或和它一样)
- 映射计算: $New\_Value = 255 \times 0.12 \approx 31$
- 结果: 所有原始灰度为 0 的像素,现在全部变为 31

当原始灰度 $i = 1$ 时:
- 累计分布 $hp(1) = 0.20$(意味着有 20% 的像素比它暗或和它一样)
- 映射计算: $New\_Value = 255 \times 0.20 = 51$
- 结果: 所有原始灰度为 1 的像素,现在全部变为 51

### 映射的本质

- $hp(i)$ 的物理意义是排名或百分位
- 映射的本质含义是: 如果你(像素 $i$)在原图中比 20% 的像素亮,那么在新图中,我就把你安排在 20% 的亮度位置(即 255 的 20% 处)

### 特殊情况: 灰度级合并

虽然不是小于 $i$ 的全映射为同一个值,但相邻的灰度级可能会映射到同一个值。

- 如果原图中灰度级 2 的像素非常少(概率为 0),那么 $hp(2)$ 和 $hp(1)$ 就会几乎相等。
- 这时,原始灰度 1 和原始灰度 2 可能会被映射到同一个新灰度值(例如都变成 51)。
- 这叫做灰度级合并,也是直方图均衡化可能减少灰度级数量的原因。

---

**<font color="#2ecc71">✅ 已格式化</font>**

